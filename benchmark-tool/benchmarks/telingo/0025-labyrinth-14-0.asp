field(1,1).
field(1,2).
field(1,3).
field(1,4).
field(1,5).
field(1,6).
field(1,7).
field(1,8).
field(1,9).
field(1,10).
field(1,11).
field(1,12).
field(1,13).
field(2,1).
field(2,2).
field(2,3).
field(2,4).
field(2,5).
field(2,6).
field(2,7).
field(2,8).
field(2,9).
field(2,10).
field(2,11).
field(2,12).
field(2,13).
field(3,1).
field(3,2).
field(3,3).
field(3,4).
field(3,5).
field(3,6).
field(3,7).
field(3,8).
field(3,9).
field(3,10).
field(3,11).
field(3,12).
field(3,13).
field(4,1).
field(4,2).
field(4,3).
field(4,4).
field(4,5).
field(4,6).
field(4,7).
field(4,8).
field(4,9).
field(4,10).
field(4,11).
field(4,12).
field(4,13).
field(5,1).
field(5,2).
field(5,3).
field(5,4).
field(5,5).
field(5,6).
field(5,7).
field(5,8).
field(5,9).
field(5,10).
field(5,11).
field(5,12).
field(5,13).
field(6,1).
field(6,2).
field(6,3).
field(6,4).
field(6,5).
field(6,6).
field(6,7).
field(6,8).
field(6,9).
field(6,10).
field(6,11).
field(6,12).
field(6,13).
field(7,1).
field(7,2).
field(7,3).
field(7,4).
field(7,5).
field(7,6).
field(7,7).
field(7,8).
field(7,9).
field(7,10).
field(7,11).
field(7,12).
field(7,13).
field(8,1).
field(8,2).
field(8,3).
field(8,4).
field(8,5).
field(8,6).
field(8,7).
field(8,8).
field(8,9).
field(8,10).
field(8,11).
field(8,12).
field(8,13).
field(9,1).
field(9,2).
field(9,3).
field(9,4).
field(9,5).
field(9,6).
field(9,7).
field(9,8).
field(9,9).
field(9,10).
field(9,11).
field(9,12).
field(9,13).
field(10,1).
field(10,2).
field(10,3).
field(10,4).
field(10,5).
field(10,6).
field(10,7).
field(10,8).
field(10,9).
field(10,10).
field(10,11).
field(10,12).
field(10,13).
field(11,1).
field(11,2).
field(11,3).
field(11,4).
field(11,5).
field(11,6).
field(11,7).
field(11,8).
field(11,9).
field(11,10).
field(11,11).
field(11,12).
field(11,13).
field(12,1).
field(12,2).
field(12,3).
field(12,4).
field(12,5).
field(12,6).
field(12,7).
field(12,8).
field(12,9).
field(12,10).
field(12,11).
field(12,12).
field(12,13).
field(13,1).
field(13,2).
field(13,3).
field(13,4).
field(13,5).
field(13,6).
field(13,7).
field(13,8).
field(13,9).
field(13,10).
field(13,11).
field(13,12).
field(13,13).
init_on(7,11).
goal_on(2,12).
connect(12,1,n).
connect(12,4,n).
connect(12,9,n).
connect(12,11,n).
connect(13,1,n).
connect(13,2,n).
connect(13,4,n).
connect(13,5,n).
connect(13,6,n).
connect(1,5,n).
connect(13,7,n).
connect(1,6,n).
connect(13,8,n).
connect(1,7,n).
connect(13,9,n).
connect(1,10,n).
connect(1,11,n).
connect(13,13,n).
connect(1,12,n).
connect(2,1,n).
connect(2,3,n).
connect(2,4,n).
connect(2,5,n).
connect(2,6,n).
connect(2,9,n).
connect(3,11,n).
connect(3,12,n).
connect(4,2,n).
connect(4,3,n).
connect(4,7,n).
connect(4,8,n).
connect(4,9,n).
connect(4,10,n).
connect(4,11,n).
connect(4,12,n).
connect(4,13,n).
connect(5,1,n).
connect(5,2,n).
connect(5,5,n).
connect(5,7,n).
connect(5,8,n).
connect(5,9,n).
connect(5,10,n).
connect(5,11,n).
connect(5,12,n).
connect(6,2,n).
connect(6,6,n).
connect(6,8,n).
connect(6,11,n).
connect(6,12,n).
connect(6,13,n).
connect(7,2,n).
connect(7,5,n).
connect(7,6,n).
connect(7,8,n).
connect(8,2,n).
connect(8,4,n).
connect(8,8,n).
connect(8,9,n).
connect(8,11,n).
connect(8,13,n).
connect(9,1,n).
connect(9,4,n).
connect(9,5,n).
connect(9,6,n).
connect(10,1,n).
connect(10,4,n).
connect(10,6,n).
connect(10,7,n).
connect(10,9,n).
connect(10,12,n).
connect(10,13,n).
connect(11,2,n).
connect(11,11,n).
connect(12,5,w).
connect(12,9,w).
connect(12,12,w).
connect(12,13,w).
connect(13,2,w).
connect(1,1,w).
connect(1,2,w).
connect(13,4,w).
connect(1,3,w).
connect(13,6,w).
connect(13,8,w).
connect(13,9,w).
connect(13,10,w).
connect(1,10,w).
connect(13,12,w).
connect(1,13,w).
connect(2,1,w).
connect(2,5,w).
connect(2,8,w).
connect(2,9,w).
connect(2,10,w).
connect(2,12,w).
connect(3,1,w).
connect(3,6,w).
connect(3,9,w).
connect(3,10,w).
connect(3,12,w).
connect(4,1,w).
connect(4,2,w).
connect(4,5,w).
connect(4,9,w).
connect(5,3,w).
connect(5,4,w).
connect(5,6,w).
connect(5,7,w).
connect(5,10,w).
connect(6,4,w).
connect(6,5,w).
connect(6,6,w).
connect(7,2,w).
connect(7,5,w).
connect(7,7,w).
connect(7,10,w).
connect(7,12,w).
connect(8,1,w).
connect(8,3,w).
connect(8,4,w).
connect(8,5,w).
connect(8,8,w).
connect(8,10,w).
connect(8,13,w).
connect(9,1,w).
connect(9,2,w).
connect(9,4,w).
connect(9,5,w).
connect(9,8,w).
connect(9,10,w).
connect(9,13,w).
connect(10,2,w).
connect(10,5,w).
connect(10,7,w).
connect(10,10,w).
connect(10,13,w).
connect(11,5,w).
connect(11,6,w).
connect(11,7,w).
connect(11,8,w).
connect(11,10,w).
connect(11,12,w).
connect(11,13,w).
connect(12,3,e).
connect(12,4,e).
connect(12,6,e).
connect(12,7,e).
connect(12,8,e).
connect(12,13,e).
connect(13,1,e).
connect(13,2,e).
connect(1,2,e).
connect(13,6,e).
connect(13,8,e).
connect(13,11,e).
connect(13,13,e).
connect(1,12,e).
connect(2,1,e).
connect(2,4,e).
connect(2,5,e).
connect(2,7,e).
connect(2,9,e).
connect(2,12,e).
connect(3,2,e).
connect(3,4,e).
connect(3,5,e).
connect(3,7,e).
connect(3,8,e).
connect(4,4,e).
connect(4,5,e).
connect(4,7,e).
connect(5,2,e).
connect(5,3,e).
connect(5,6,e).
connect(5,7,e).
connect(5,8,e).
connect(5,10,e).
connect(5,11,e).
connect(5,13,e).
connect(6,1,e).
connect(6,3,e).
connect(6,4,e).
connect(6,10,e).
connect(6,13,e).
connect(7,3,e).
connect(7,4,e).
connect(7,5,e).
connect(7,9,e).
connect(7,11,e).
connect(7,13,e).
connect(8,2,e).
connect(8,3,e).
connect(8,7,e).
connect(8,11,e).
connect(8,13,e).
connect(9,1,e).
connect(9,3,e).
connect(9,4,e).
connect(9,9,e).
connect(9,10,e).
connect(9,12,e).
connect(10,1,e).
connect(10,4,e).
connect(10,7,e).
connect(10,11,e).
connect(10,13,e).
connect(11,1,e).
connect(11,2,e).
connect(11,3,e).
connect(11,6,e).
connect(11,10,e).
connect(11,11,e).
connect(11,12,e).
connect(11,13,e).
connect(12,2,s).
connect(12,4,s).
connect(12,8,s).
connect(12,9,s).
connect(12,10,s).
connect(12,13,s).
connect(13,2,s).
connect(1,1,s).
connect(13,3,s).
connect(1,2,s).
connect(1,4,s).
connect(13,6,s).
connect(1,8,s).
connect(1,9,s).
connect(1,10,s).
connect(13,13,s).
connect(1,12,s).
connect(2,2,s).
connect(2,5,s).
connect(2,9,s).
connect(2,10,s).
connect(2,11,s).
connect(2,12,s).
connect(2,13,s).
connect(3,1,s).
connect(3,3,s).
connect(3,13,s).
connect(4,2,s).
connect(4,5,s).
connect(4,6,s).
connect(4,7,s).
connect(4,12,s).
connect(5,2,s).
connect(5,3,s).
connect(5,7,s).
connect(5,8,s).
connect(5,10,s).
connect(5,11,s).
connect(5,12,s).
connect(6,1,s).
connect(6,2,s).
connect(6,4,s).
connect(6,7,s).
connect(6,9,s).
connect(6,13,s).
connect(7,1,s).
connect(7,3,s).
connect(7,11,s).
connect(8,1,s).
connect(8,2,s).
connect(8,4,s).
connect(8,6,s).
connect(8,7,s).
connect(8,12,s).
connect(9,2,s).
connect(9,7,s).
connect(9,10,s).
connect(9,11,s).
connect(10,1,s).
connect(10,3,s).
connect(10,4,s).
connect(10,8,s).
connect(10,9,s).
connect(11,4,s).
connect(11,9,s).
connect(11,10,s).
connect(11,11,s).
connect(11,12,s).
max_steps(13).
#program initial.
dir(e). dir(w). dir(n). dir(s).
inverse(e,w). inverse(w,e).
inverse(n,s). inverse(s,n).

row(X) :- field(X,Y).
col(Y) :- field(X,Y).

num_rows(X) :- row(X), not row(XX), XX = X+1.
num_cols(Y) :- col(Y), not col(YY), YY = Y+1.

goal(X,Y)   :- goal_on(X,Y).
reach(X,Y)  :- init_on(X,Y).
conn(X,Y,D) :- connect(X,Y,D).

dneighbor(n,X,Y,XX,Y) :- field(X,Y), field(XX,Y), XX = X+1.
dneighbor(s,X,Y,XX,Y) :- field(X,Y), field(XX,Y), XX = X-1.
dneighbor(e,X,Y,X,YY) :- field(X,Y), field(X,YY), YY = Y+1.
dneighbor(w,X,Y,X,YY) :- field(X,Y), field(X,YY), YY = Y-1.

neighbor(D,X,Y,XX,YY) :- dneighbor(D,X,Y,XX,YY).
neighbor(n,X,Y, 1, Y) :- field(X,Y), num_rows(X).
neighbor(s,1,Y, X, Y) :- field(X,Y), num_rows(X).
neighbor(e,X,Y, X, 1) :- field(X,Y), num_cols(Y).
neighbor(w,X,1, X, Y) :- field(X,Y), num_cols(Y).

#program always.
neg_goal :- goal(X,Y), not reach(X,Y).

#program dynamic.
{ occurs(some_action) }.
rrpush   :- 'neg_goal, not ccpush, occurs(some_action).
ccpush   :- 'neg_goal, not rrpush, occurs(some_action).

orpush(X) :- _row(X), _row(XX), rpush(XX), X != XX.
ocpush(Y) :- _col(Y), _col(YY), cpush(YY), Y != YY.

rpush(X)  :- _row(X), rrpush, not orpush(X).
cpush(Y)  :- _col(Y), ccpush, not ocpush(Y).

push(X,e) :- rpush(X), not push(X,w).
push(X,w) :- rpush(X), not push(X,e).
push(Y,n) :- cpush(Y), not push(Y,s).
push(Y,s) :- cpush(Y), not push(Y,n).

shift(XX,YY,X,Y) :- _neighbor(e,XX,YY,X,Y), push(XX,e).
shift(XX,YY,X,Y) :- _neighbor(w,XX,YY,X,Y), push(XX,w).
shift(XX,YY,X,Y) :- _neighbor(n,XX,YY,X,Y), push(YY,n).
shift(XX,YY,X,Y) :- _neighbor(s,XX,YY,X,Y), push(YY,s).
shift( X, Y,X,Y) :- _field(X,Y), not push(X,e), not push(X,w), not push(Y,n), not push(Y,s).

conn(X,Y,D) :- 'conn(XX,YY,D), _dir(D), shift(XX,YY,X,Y).

goal(X,Y) :- 'goal(XX,YY), shift(XX,YY,X,Y).

reach(X,Y) :- 'reach(XX,YY), shift(XX,YY,X,Y).
reach(X,Y) :- reach(XX,YY), _dneighbor(D,XX,YY,X,Y), conn(XX,YY,D), conn(X,Y,E), _inverse(D,E).

#program final.
:- neg_goal.
